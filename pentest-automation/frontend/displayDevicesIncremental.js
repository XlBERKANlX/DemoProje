// Display devices incrementally during scan
function displayDevicesIncremental(devices, isScanning = false) {
    devicesList.innerHTML = '';

    // Add scanning indicator if still scanning
    if (isScanning) {
        const scanningIndicator = document.createElement('div');
        scanningIndicator.style.cssText = 'color: #05D8DF; padding: 10px 20px; font-weight: 600; border-bottom: 1px solid #485C7E;';
        scanningIndicator.innerHTML = 'â³ Tarama devam ediyor...';
        devicesList.appendChild(scanningIndicator);
    }

    devices.forEach((device, index) => {
        const deviceItem = document.createElement('div');
        deviceItem.className = 'device-item';
        if (index === 0 && !isScanning) deviceItem.classList.add('device-selected');

        // Get device icon
        const iconInfo = getDeviceIcon(device.hostname || device.ip, device.os || '');

        // Count vulnerabilities (placeholder for now)
        const vulnCounts = device.vulnerabilities || { critical: 0, medium: 0, low: 0 };
        const portCount = device.ports ? device.ports.length : 0;

        deviceItem.innerHTML = `
            <div class="device-icon">
                <img src="${iconInfo.src}" alt="${iconInfo.alt}" class="device-icon-img" 
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                <span class="device-icon-fallback" style="display:none;">${iconInfo.fallback}</span>
            </div>
            <div class="device-info">
                <div class="device-name">${device.ip} (${device.hostname})</div>
                <div class="device-stats">
                    ${vulnCounts.critical > 0 ? `<span class="stat-critical">ðŸ”¥ Kritik: ${vulnCounts.critical}</span>` : ''}
                    ${vulnCounts.medium > 0 ? `<span class="stat-medium">ðŸŸ  Orta: ${vulnCounts.medium}</span>` : ''}
                    ${vulnCounts.low > 0 ? `<span class="stat-low">ðŸŸ¡ DÃ¼ÅŸÃ¼k: ${vulnCounts.low}</span>` : ''}
                    ${portCount > 0 ? `<span class="stat-safe">ðŸŸ¢ Port: ${portCount}</span>` : '<span class="stat-safe">ðŸŸ¢ Aktif</span>'}
                </div>
            </div>
            <div class="device-arrow">></div>
        `;

        // Store device data
        deviceItem.dataset.deviceData = JSON.stringify(device);

        // Add click handler
        deviceItem.addEventListener('click', () => {
            document.querySelectorAll('.device-item').forEach(d => d.classList.remove('device-selected'));
            deviceItem.classList.add('device-selected');
            displayTechnicalDetails(device);
        });

        devicesList.appendChild(deviceItem);
    });

    // Display first device details if not scanning
    if (devices.length > 0 && !isScanning) {
        displayTechnicalDetails(devices[0]);
    }
}
