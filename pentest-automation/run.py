#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Pentest Otomasyon Motoru - CLI Launcher
Starts the Flask server and opens the web interface in the default browser.
"""

import os
import sys
import time
import webbrowser
import subprocess
from pathlib import Path

def main():
    print("=" * 60)
    print("PENTEST OTOMASYON MOTORU")
    print("=" * 60)
    print()
    
    # Get the project root directory
    project_root = Path(__file__).parent
    backend_dir = project_root / 'backend'
    
    # Check if backend directory exists
    if not backend_dir.exists():
        print("[HATA] Backend dizini bulunamadi!")
        sys.exit(1)
    
    # Check if requirements are installed
    print("[*] Bagimliliklari kontrol ediliyor...")
    try:
        import flask
        import flask_cors
        print("[+] Flask kurulu")
    except ImportError:
        print("[!] Flask kurulu degil. Yukleniyor...")
        subprocess.run([sys.executable, '-m', 'pip', 'install', '-r', 
                       str(backend_dir / 'requirements.txt')], check=True)
    
    print()
    print("[*] Server baslatiliyor...")
    print("[*] URL: http://localhost:5000")
    print()
    print("[!] Durdurmak icin CTRL+C tushlarina basin")
    print("=" * 60)
    print()
    
    # Wait a moment for the server to start
    time.sleep(2)
    
    # Open browser
    print("[*] Tarayici aciliyor...")
    webbrowser.open('http://localhost:5000')
    
    # Start Flask server
    os.chdir(backend_dir)
    subprocess.run([sys.executable, 'app.py'])

if __name__ == '__main__':
    try:
        main()
    except KeyboardInterrupt:
        print("\n\n[*] Pentest Otomasyon Motoru kapatiliyor...")
        sys.exit(0)
    except Exception as e:
        print(f"\n[HATA] {e}")
        sys.exit(1)
