# Pentest Otomasyon Projesi - Devir Teslim Dokümanı

Bu doküman, projenin mevcut durumunu, mimari yapısını ve kritik kod mantıklarını yeni bir yapay zeka oturumuna aktarmak için hazırlanmıştır.

## 1. Proje Özeti
**Amaç:** Nmap tabanlı bir pentest otomasyon aracı geliştirmek. Kullanıcı arayüzünden tarama başlatıp, sonuçları anlık (real-time) izleyebiliyor ve bulunan zafiyetleri Gemini AI ile analiz ettirebiliyor.

**Teknoloji Yığını:**
*   **Backend:** Python (Flask), `python-nmap` yerine doğrudan `subprocess` kullanımı.
*   **Frontend:** HTML5, CSS3, Vanilla JavaScript (Framework yok).
*   **AI:** Google Gemini API (`google-generativeai`).
*   **Araçlar:** Nmap (Sistemde kurulu olmalı).

---

## 2. Dosya Yapısı ve İşlevler

```text
/backend
  ├── app.py           # Flask sunucusu, API endpointleri, Thread yönetimi
  ├── scanner.py       # Nmap komut oluşturma, Process yönetimi, Çıktı parse etme
  └── ai_analyzer.py   # Gemini API entegrasyonu, Prompt mühendisliği
/frontend
  ├── index.html       # Ana arayüz
  ├── styles.css       # Tasarım (Cyberpunk/Dark tema)
  └── app.js           # Frontend mantığı, Polling, DOM manipülasyonu
.env                   # API Key barındırır
```

---

## 3. Kritik Modüller ve Mantık

### A. Nmap Tarama Modülü (`backend/scanner.py`)
*   **Çalışma Şekli:** `active_scans` sözlüğünde işlem (process) ID'leri tutulur.
*   **Komut Yapısı:** `-oX -` (XML çıktısı) ve `-v` (Verbose) flagleri kullanılır.
*   **Real-Time Parsing:**
    *   Standart çıktı (XML) işlem sonunda parse edilir.
    *   `stderr` (Hata çıktısı/Verbose) **ayrı bir thread** ile satır satır okunur.
    *   Regex ile `Discovered open port X/tcp` ve `Nmap scan report for IP` satırları yakalanır.
    *   Bu sayede tarama bitmeden portlar arayüze anlık düşer.
*   **Özellikler:**
    *   Hız seçenekleri (T0-T5).
    *   UDP taramaları için özel timeout süreleri.
    *   İptal mekanizması (`process.kill()`).

### B. Yapay Zeka Analizi (`backend/ai_analyzer.py`)
*   **Model:** `gemini-1.5-flash` (Hız/Maliyet dengesi için).
*   **Girdi:** Cihazın IP'si, İşletim Sistemi, Açık Portlar ve **Servis Versiyonları**.
*   **Prompt Stratejisi:**
    *   JSON formatında çıktı istenir.
    *   **CVSS Skorlaması:** Zafiyetlerin standard CVSS v3.1 puanları istenir.
    *   **Risk Skoru:** 0-100 yerine **0.0 - 10.0** aralığında istenir. Genel risk skoru, tespit edilen **en yüksek CVSS puanına** eşitlenir.
*   **Bağımlılıklar:** `google-generativeai`, `python-dotenv`.

### C. Frontend Mantığı (`frontend/app.js`)
*   **Polling:** `pollScanStatus` fonksiyonu her 2 saniyede bir backend'e sorar.
*   **Radio Button Mantığı:** "Host Keşfi" ile "Port Taraması" birbirini dışlar (Mutual Exclusion).
*   **Görselleştirme:**
    *   Cihazlar bulundukça listeye eklenir.
    *   AI butonuna basılınca loader çıkar, sonuç gelince renkli kartlar halinde gösterilir.
    *   Risk seviyesine göre renk değişir (Yeşil < 2.5 < Sarı < 5.0 < Turuncu < 7.5 < Kırmızı).

### D. API Endpointleri
*   `POST /api/scan/start`: Tarama başlatır.
*   `GET /api/scan/status/<id>`: Durum sorar (Running/Completed).
*   `GET /api/scan/results/<id>`: Anlık bulguları JSON döner.
*   `POST /api/scan/cancel/<id>`: İşlemi öldürür.
*   `POST /api/analyze/device`: Cihaz verisini alır, AI analiz sonucunu döner.

---

## 4. Kaydedilmiş Geliştirmeler (Status Quo)
1.  **Risk Skoru:** 0-10 aralığına çekildi. AI artık rastgele puan vermiyor, CVE veritabanındaki CVSS skorunu baz alıyor.
2.  **Verbose Parsing:** "Host is up" mesajı yakalanıp cihaz hemen ekleniyor (portları beklemeden).
3.  **UI Renkleri:** AI sonuçları için renk skalası (0-2.5, 2.5-5, 5-7.5, 7.5-10) ayarlandı.
4.  **Konfigürasyon:** `.env` dosyasında `GEMINI_API_KEY` tanımlı.

## 5. Gelecek Planları (Sıradaki İşler)
*   Nikto ve Gobuster araçlarının eklenmesi.
*   Raporlama (PDF/HTML export).
*   Çoklu hedef yönetimi.
