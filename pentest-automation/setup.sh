#!/bin/bash

# Pentest Automation Engine - Setup Script for Kali Linux
# This script creates a virtual environment and installs dependencies

echo "ğŸ›¡ï¸  Pentest Otomasyon Motoru - Kurulum"
echo "========================================"
echo ""

# Check if running on Kali Linux
if [ -f /etc/os-release ]; then
    . /etc/os-release
    if [[ "$ID" == "kali" ]]; then
        echo "âœ… Kali Linux tespit edildi"
    fi
fi

# Check if venv module is available
echo "[*] Python venv modÃ¼lÃ¼ kontrol ediliyor..."
if ! python3 -m venv --help &> /dev/null; then
    echo "[!] python3-venv kurulu deÄŸil. Kuruluyor..."
    sudo apt update
    sudo apt install -y python3-venv
fi

# Create virtual environment
VENV_DIR="venv"

if [ -d "$VENV_DIR" ]; then
    echo "[*] Virtual environment mevcut: $VENV_DIR"
else
    echo "[*] Virtual environment oluÅŸturuluyor..."
    python3 -m venv $VENV_DIR
    echo "âœ… Virtual environment oluÅŸturuldu"
fi

# Activate virtual environment
echo "[*] Virtual environment aktifleÅŸtiriliyor..."
source $VENV_DIR/bin/activate

# Upgrade pip
echo "[*] pip gÃ¼ncelleniyor..."
pip install --upgrade pip

# Install dependencies
echo "[*] BaÄŸÄ±mlÄ±lÄ±klar yÃ¼kleniyor..."
pip install -r backend/requirements.txt

# Ensure groq is latest version (fix for 'proxies' error)
echo "[*] Groq paketi gÃ¼ncelleniyor (son sÃ¼rÃ¼m)..."
pip install --upgrade groq

echo ""
echo "âœ… Kurulum tamamlandÄ±!"
echo ""
echo "âš ï¸  Ã–NEMLÄ°: Groq API anahtarÄ±nÄ±zÄ± ayarlayÄ±n:"
echo ""
echo "1. .env dosyasÄ± oluÅŸturun:"
echo "   nano .env"
echo ""
echo "2. Ä°Ã§ine ÅŸunlarÄ± yazÄ±n:"
echo "   GROQ_API_KEY=your_groq_api_key_here"
echo "   GROQ_MODEL=llama-3.1-70b-versatile"
echo ""
echo "3. Ãœcretsiz API anahtarÄ± alÄ±n:"
echo "   https://console.groq.com/"
echo ""
echo "ğŸ“ UygulamayÄ± baÅŸlatmak iÃ§in:"
echo "   ./start.sh"
echo ""
echo "ğŸ“ Manuel olarak baÅŸlatmak iÃ§in:"
echo "   source venv/bin/activate"
echo "   python run.py"
echo ""
